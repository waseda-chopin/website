<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>早稲田大学ショパンの会</title>
        <meta name="description" content="早稲田大学ショパンの会の公式サイトです！">
        <link rel="stylesheet" href="css/style.css"></link>
    </head>

    <body>
        <div id="header-container"></div>

        <p>※こちらは2025年3月に作った新webサイトです。旧サイトは閉鎖しました。</p>
        <h2>ご挨拶</h2>
        
        <p>こんにちは！早稲田大学ショパンの会の公式サイトへようこそ！</p>
        <p>当サークルは会員の演奏レベルや所属大学を問わず、音楽に触れる喜びを共有することを目的としたピアノサークルです。このWebサイトは当サークルに関する様々な情報やコンサートプログラムの紹介を目的としています。</p>

        <div class="field">
            <div class="article">
                <h3>新着情報</h3>
                <div id="news-container">
                    <p>読み込み中...</p>
                </div>
            </div>
            <div class="article">
                <h3>入会について</h3>
                <p>入会したい場合は当サークルのメールアドレスへの連絡やSNSアカウントへのダイレクトメッセージでお伝えください。<br>
                会費や演奏会についてはIntroductionに記載しておりますのでそちらを参照してください。</p>
            </div>
        </div>

        <div class="article" id="shinkan" style="display: none; text-align: center;">
            </div>

        <div id="footer"></div>
        
        <script>
            // --- 既存のヘッダー読み込み処理 ---
            const isMobile = window.innerWidth <= 768;
            const headerFile = isMobile ? 'phone-header.html' : 'pc-header.html';

            function loadHeader() {
                const timestamp = new Date().getTime(); // キャッシュ防止用のタイムスタンプ
                const hFile = window.innerWidth > 768 ? "pc-header.html" : "phone-header.html";
                
                fetch(`${hFile}?v=${timestamp}`)  
                    .then((response) => response.text())
                    .then((data) => {
                        const header = document.querySelector("#header") || document.querySelector("#header-container");
                        if (header) header.innerHTML = data;
                    });
            }

            // 初回ロード時＆リサイズ時にヘッダーを読み込む
            loadHeader();
            window.addEventListener("resize", loadHeader);
            window.addEventListener("orientationchange", loadHeader);

            // --- 新着情報 ＆ 新歓情報の読み込み処理 ---
            const JSON_URL = './data/news.json'; 

            fetch(JSON_URL)
                .then(response => {
                    if (!response.ok) throw new Error("JSONファイルが見つかりません (404)");
                    return response.json();
                })
                .then(data => {
                    const newsContainer = document.getElementById('news-container');
                    const shinkanContainer = document.getElementById('shinkan');
                    
                    let newsHtml = '';
                    let shinkanHtml = '';

                    // データが存在する場合
                    if (data && data.length > 0) {
                        data.forEach(item => {
                            // 改行コードを <br> に変換
                            const contentWithBreaks = item.content ? item.content.replace(/\n/g, '<br>') : '';
                            
                            // 条件：カテゴリが「新歓」かつ、タイトルが空欄（null または 空文字）
                            if (item.category === '新歓' && (!item.title || item.title.trim() === '')) {
                                // 配色指定を外し、太字指定のみに変更
                                shinkanHtml += `<h3 style="font-weight: bold; margin: 10px 0;">${contentWithBreaks}</h3>`;
                            } else {
                                // それ以外は通常のニュースとしてリスト化
                                newsHtml += `
                                    <li>${item.title || 'お知らせ'}</li>
                                    <p>${contentWithBreaks}</p>
                                `;
                            }
                        });
                    }

                    // 通常の新着情報を反映
                    if (newsHtml !== '') {
                        newsContainer.innerHTML = newsHtml;
                    } else {
                        newsContainer.innerHTML = '<p>現在お知らせはありません。</p>';
                    }

                    // 新歓のアナウンスがあれば、下段のコンテナを表示して反映
                    if (shinkanHtml !== '') {
                        shinkanContainer.innerHTML = shinkanHtml;
                        shinkanContainer.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Newsの読み込みエラー:', error);
                    document.getElementById('news-container').innerHTML = '<p>現在お知らせはありません。</p>';
                });

            // --- 既存のフッター読み込み処理 ---
            fetch("footer.html")
            .then((response) => response.text())
            .then((data) => {
                const footer = document.querySelector("#footer");
                if (footer) {
                    footer.innerHTML = data;
                } else {
                    console.error("要素 #footer が見つかりません。");
                }
            })
            .catch((error) => console.error("footer.html の読み込みに失敗しました:", error));
        </script>
    </body>
</html>