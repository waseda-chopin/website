<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>早稲田大学ショパンの会</title>
        <meta name="discription" content="早稲田大学ショパンの会の公式サイトです！">
        <link rel="stylesheet" href="css/style.css"></link>
    </head>

    <body>
        <div id="header-container"></div>

        <p>※こちらは2025年3月に作った新webサイトです。旧サイトは閉鎖しました。</p>
        <h2>ご挨拶</h2>
        
        <p>こんにちは！早稲田大学ショパンの会の公式サイトへようこそ！</p>
        <p>当サークルは会員の演奏レベルや所属大学を問わず、音楽に触れる喜びを共有することを目的としたピアノサークルです。このWebサイトは当サークルに関する様々な情報やコンサートプログラムの紹介を目的としています。</p>

        <div class="field">
            <div class="article">
                <h3>新着情報</h3>
                <div id="news-container">
                    <p>読み込み中...</p>
                </div>
            </div>
            <div class="article">
                <h3>入会について</h3>
                <p>入会したい場合は当サークルのメールアドレスへの連絡やSNSアカウントへのダイレクトメッセージでお伝えください。<br>
                会費や演奏会についてはIntroductionに記載しておりますのでそちらを参照してください。</p>
            </div>
        </div>
        <div id="footer"></div>
        

        <script>
            // --- 既存のヘッダー読み込み処理 ---
            const isMobile = window.innerWidth <= 768;
            const headerFile = isMobile ? 'phone-header.html' : 'pc-header.html';

            // ヘッダーを読み込んで挿入
            fetch(headerFile)
                .then(response => response.text())
                .then(data => {
                    const container = document.getElementById('header-container');
                    if (container) container.innerHTML = data;
                })
                .catch(error => console.error('ヘッダーの読み込みに失敗しました:', error));

            function loadHeader() {
                const timestamp = new Date().getTime(); // キャッシュ防止用のタイムスタンプ
                const headerFile = window.innerWidth > 768 ? "pc-header.html" : "phone-header.html";
                
                fetch(`${headerFile}?v=${timestamp}`)  // キャッシュ対策
                    .then((response) => response.text())
                    .then((data) => {
                        // 元のコードに合わせて #header を探しますが、なければ #header-container に入れます
                        const header = document.querySelector("#header") || document.querySelector("#header-container");
                        if (header) header.innerHTML = data;
                    });
            }

            // 初回ロード時にヘッダーを読み込む
            loadHeader();

            // 画面サイズ変更時にヘッダーを再読み込み（iOSの回転対応）
            window.addEventListener("resize", loadHeader);
            window.addEventListener("orientationchange", loadHeader);


            // --- ここから新着情報の読み込み処理 (追加) ---
            const JSON_URL = './data/news.json'; 

            fetch(JSON_URL)
                .then(response => {
                    if (!response.ok) throw new Error("JSONファイルが見つかりません (404)");
                    return response.json();
                })
                .then(data => {
                    const newsContainer = document.getElementById('news-container');
                    let htmlContent = '';

                    // データが存在する場合
                    if (data && data.length > 0) {
                        // 日付の新しい順（降順）に並び替えたい場合はここで sort する
                        // data.sort((a, b) => new Date(b.date) - new Date(a.date));

                        data.forEach(item => {
                            // 改行コードを <br> に変換
                            const contentWithBreaks = item.content ? item.content.replace(/\n/g, '<br>') : '';
                            
                            // <li>タイトル</li>
                            // <p>本文</p>
                            // というHTML構造を生成します
                            htmlContent += `
                                <li>${item.title}</li>
                                <p>${contentWithBreaks}</p>
                            `;
                        });
                    } else {
                        htmlContent = '<p>現在お知らせはありません。</p>';
                    }

                    newsContainer.innerHTML = htmlContent;
                })
                .catch(error => {
                    console.error('Newsの読み込みエラー:', error);
                    // まだJSONがない場合やエラー時の表示
                    document.getElementById('news-container').innerHTML = '<p>現在お知らせはありません。</p>';
                });
            // --- 新着情報読み込み処理終了 ---


            // --- 既存のフッター読み込み処理 ---
            fetch("footer.html")
            .then((response) => response.text())
            .then((data) => {
                const footer = document.querySelector("#footer");
                if (footer) {
                    footer.innerHTML = data;
                } else {
                    console.error("要素 #footer が見つかりません。");
                }
            })
            .catch((error) => console.error("footer.html の読み込みに失敗しました:", error));
        </script>
    </body>
</html>